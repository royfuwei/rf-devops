fullnameOverride: api

service:
  port: 3000
containerPort: 3000

env:
  APP_NAME: "rfjs/app"
  PORT: "3000"

secretEnv: {}

secrets:
  existingSecretName: api-env
  useEnvFrom: true

ingress:
  enabled: true
  tls:
    enabled: true
    secretName: rfjs-tls-secret  # 使用的 TLS 憑證
    certManager:
      enabled: true   # ✅ 改成底下是一個物件，這樣 template 可以用
      issuerType: cluster-issuer  # "issuer" or "cluster-issuer"
      issuerName: letsencrypt-dns
      keepCertificate: false   # ⬅️ ✅ 新增這一行：控制是否啟用 "keep"
  annotations:
    spec.ingressClassName: nginx
    nginx.ingress.kubernetes.io/proxy-body-size: '0'
    nginx.ingress.kubernetes.io/proxy-read-timeout: '600'
    nginx.ingress.kubernetes.io/proxy-send-timeout: '600'
    nginx.ingress.kubernetes.io/use-regex: 'true'
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"   # ✅ 新增這行
    cert-manager.io/cluster-issuer: letsencrypt-dns # 關閉自建 certificate 改用 cert-manager
  hosts:
    - host: rfjs.api.royfuwei.dev
      paths:
        - path: /
          pathType: Prefix

# Traefik + cert-manager
# ingress:
#   enabled: true
#   className: traefik
#   annotations:
#     cert-manager.io/cluster-issuer: "letsencrypt-prod"
#   hosts:
#     - host: api.royfuwei.dev
#       paths:
#         - path: /
#   tls:
#     - secretName: api-tls
#       hosts:
#         - api.royfuwei.dev

